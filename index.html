<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>语音助手</title>
    <link rel="stylesheet" href="./try.css">
    <script src="./try.js" defer></script>
    <style>
        /* 小程序环境优化 */
        body {
            margin: 0;
            padding: 0;
            background: transparent !important;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        /* 隐藏不需要的元素 */
        #contentFrame,
        .voice-icon-container {
            display: none !important;
        }
        
        /* 强制显示助手窗口 */
        .assistant-container {
            display: block !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            padding: 15px !important;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(10px);
            border-radius: 15px;
            z-index: 10000;
            overflow: hidden;
        }
        
        /* 响应式调整 */
        @media (max-width: 400px) {
            .assistant-container {
                padding: 10px !important;
                border-radius: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- 只保留助手窗口 -->
    <div class="assistant-container" id="assistantContainer">
        <div class="assistant-header">
            <div class="assistant-title">小瞳同学智能语音助手</div>
            <div class="assistant-controls">
                <button class="control-btn minimize-btn" onclick="minimizeWindow()">−</button>
                <button class="control-btn close-btn" onclick="closeWindow()">×</button>
            </div>
        </div>
        
        <div class="api-status" id="apiStatus">
            <span class="connected"></span>
            <span>API已连接</span>
        </div>
        
        <div class="visualizer">
            <canvas class="waveform" id="waveform"></canvas>
        </div>
        
        <button class="mic-button" id="toggleBtn">
            <i class="fas fa-microphone"></i>
        </button>
        
        <div class="transcript-container" id="transcript">
            <div class="message assistant-message">
                <div class="message-header">
                    <i class="fas fa-robot"></i>
                    <span>小瞳同学</span>
                </div>
                <div class="message-content">
                    语音助手已就绪，请点击麦克风开始对话
                </div>
            </div>
        </div>
        
        <div class="voice-controls">
            <div class="control-group">
                <label>语音选择:</label>
                <select id="voiceSelect"></select>
            </div>
            
            <div class="control-group">
                <label>背景音乐音量:</label>
                <input type="range" id="backgroundMusicControl" min="0" max="1" step="0.05" value="0.3">
            </div>
            
            <div class="control-group">
                <label>语速:</label>
                <input type="range" id="rateControl" min="0.5" max="2" step="0.1" value="1">
            </div>
            
            <div class="control-group">
                <label>朗读音量:</label>
                <input type="range" id="volumeControl" min="0" max="1" step="0.05" value="1">
            </div>
        </div>
    </div>

    <!-- 背景音乐 -->
    <audio id="backgroundMusic">
        <source src="../music/gaoshanliushui.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 小程序环境适配
        function minimizeWindow() {
            if (typeof wx !== 'undefined' && wx.miniProgram) {
                wx.miniProgram.postMessage({ 
                    data: { type: 'minimize' }
                });
            }
        }
        
        function closeWindow() {
            if (typeof wx !== 'undefined' && wx.miniProgram) {
                wx.miniProgram.postMessage({ 
                    data: { type: 'close' }
                });
            }
        }
        
        // 页面加载完成后调整布局
        window.addEventListener('load', function() {
            adjustLayoutForMiniProgram();
        });
        
        function adjustLayoutForMiniProgram() {
            const container = document.getElementById('assistantContainer');
            if (container) {
                // 确保容器完全显示
                container.style.display = 'block';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
            }
        }
    </script>
</body>
</html>
